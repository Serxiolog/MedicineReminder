# Архитектура приложения "Напоминалка о лекарствах"

## 1. Общая архитектура

Приложение построено по трёхслойной архитектуре:

### Слои:
1. **Presentation Layer (UI)** - Blazor компоненты
2. **Business Logic Layer** - Сервисы
3. **Data Layer** - Модели и хранилище данных

```
┌─────────────────────────────────────────┐
│         Presentation Layer              │
│   (Blazor Pages: Home, Medicines, etc.) │
└────────────────┬────────────────────────┘
                 │
┌────────────────▼────────────────────────┐
│       Business Logic Layer              │
│  (DataService, NotificationService)     │
└────────────────┬────────────────────────┘
                 │
┌────────────────▼────────────────────────┐
│           Data Layer                    │
│  (Models: Medicine, Reminder + JSON)    │
└─────────────────────────────────────────┘
```

## 2. Диаграмма классов (Class Diagram)

### Основные классы и их связи:

```
┌─────────────────────────┐
│      Medicine           │
├─────────────────────────┤
│ + Id: Guid              │
│ + Name: string          │
│ + Dosage: string        │
│ + Frequency: string     │
│ + Time: TimeSpan        │
│ + StartDate: DateTime   │
│ + EndDate: DateTime?    │
│ + Notes: string         │
│ + IsActive: bool        │
│ + SelectedDays: List    │
└──────────┬──────────────┘
           │ 1
           │
           │ *
┌──────────▼──────────────┐
│      Reminder           │
├─────────────────────────┤
│ + Id: Guid              │
│ + MedicineId: Guid      │
│ + ScheduledTime: DateTime│
│ + IsCompleted: bool     │
│ + CompletedTime: DateTime?│
└─────────────────────────┘

┌─────────────────────────┐
│     DataService         │
├─────────────────────────┤
│ - _medicines: List      │
│ - _reminders: List      │
├─────────────────────────┤
│ + GetAllMedicinesAsync()│
│ + AddMedicineAsync()    │
│ + UpdateMedicineAsync() │
│ + DeleteMedicineAsync() │
│ + GetAllRemindersAsync()│
│ + GenerateReminders()   │
└─────────────────────────┘

┌─────────────────────────┐
│  INotificationService   │
├─────────────────────────┤
│ + ScheduleNotification()│
│ + CancelNotification()  │
│ + RequestPermissions()  │
└──────────┬──────────────┘
           │
           │ implements
           │
┌──────────▼──────────────┐
│  NotificationService    │
│     (Android)           │
├─────────────────────────┤
│ - CreateChannel()       │
│ + ScheduleNotification()│
│ + CancelNotification()  │
└─────────────────────────┘
```

## 3. Use Case диаграмма

```
                    ┌──────────────────┐
                    │  Пользователь    │
                    └────────┬─────────┘
                             │
        ┌────────────────────┼────────────────────┐
        │                    │                    │
        ▼                    ▼                    ▼
┌───────────────┐   ┌────────────────┐   ┌──────────────┐
│  Добавить     │   │  Просмотреть   │   │  Получить    │
│  лекарство    │   │  лекарства     │   │  уведомление │
└───────────────┘   └────────────────┘   └──────────────┘
        │                    │                    
        │                    │                    
        ▼                    ▼                    
┌───────────────┐   ┌────────────────┐           
│  Редактировать│   │  Просмотреть   │           
│  лекарство    │   │  напоминания   │           
└───────────────┘   └────────────────┘           
        │                    │                    
        │                    │                    
        ▼                    ▼                    
┌───────────────┐   ┌────────────────┐           
│  Удалить      │   │  Отметить о    │           
│  лекарство    │   │  приёме        │           
└───────────────┘   └────────────────┘           
```

### Описание Use Cases:

1. **Добавить лекарство**
   - Актор: Пользователь
   - Описание: Пользователь вводит данные о новом лекарстве
   - Основной сценарий:
     1. Пользователь открывает форму добавления
     2. Заполняет обязательные поля (название, дозировка, частота, время)
     3. Опционально выбирает дни недели и период приёма
     4. Нажимает "Сохранить"
     5. Система создаёт напоминания

2. **Просмотреть лекарства**
   - Актор: Пользователь
   - Описание: Просмотр списка всех добавленных лекарств
   - Основной сценарий:
     1. Пользователь открывает раздел "Мои лекарства"
     2. Система отображает список с деталями каждого лекарства

3. **Редактировать лекарство**
   - Актор: Пользователь
   - Описание: Изменение данных существующего лекарства
   - Основной сценарий:
     1. Пользователь выбирает лекарство для редактирования
     2. Изменяет необходимые поля
     3. Сохраняет изменения
     4. Система обновляет напоминания

4. **Удалить лекарство**
   - Актор: Пользователь
   - Описание: Удаление лекарства из списка
   - Основной сценарий:
     1. Пользователь выбирает лекарство
     2. Нажимает кнопку "Удалить"
     3. Система удаляет лекарство и связанные напоминания

5. **Просмотреть напоминания**
   - Актор: Пользователь
   - Описание: Просмотр предстоящих и прошедших приёмов
   - Основной сценарий:
     1. Пользователь открывает раздел "Предстоящие приёмы"
     2. Система отображает напоминания, сгруппированные по датам

6. **Отметить о приёме**
   - Актор: Пользователь
   - Описание: Подтверждение приёма лекарства
   - Основной сценарий:
     1. Пользователь видит напоминание
     2. Нажимает "Отметить" или кнопку в уведомлении
     3. Система помечает приём как выполненный

7. **Получить уведомление**
   - Актор: Система
   - Описание: Автоматическое уведомление в заданное время
   - Основной сценарий:
     1. Наступает время приёма лекарства
     2. Система отправляет push-уведомление
     3. Пользователь видит уведомление

## 4. Sequence диаграмма: Добавление лекарства

```
Пользователь    UI (AddMedicine)    DataService    NotificationService
     │                 │                  │                 │
     │ Заполняет форму │                  │                 │
     ├────────────────►│                  │                 │
     │                 │                  │                 │
     │ Нажимает        │                  │                 │
     │ "Сохранить"     │                  │                 │
     ├────────────────►│                  │                 │
     │                 │                  │                 │
     │                 │ AddMedicineAsync()│                 │
     │                 ├─────────────────►│                 │
     │                 │                  │                 │
     │                 │                  │ Сохраняет в JSON│
     │                 │                  ├────────────────►│
     │                 │                  │                 │
     │                 │ GenerateReminders()                │
     │                 ├─────────────────►│                 │
     │                 │                  │                 │
     │                 │                  │ Создаёт Reminder│
     │                 │                  ├────────────────►│
     │                 │                  │                 │
     │                 │ RequestPermissions()               │
     │                 ├───────────────────────────────────►│
     │                 │                  │                 │
     │                 │ ScheduleNotification()             │
     │                 ├───────────────────────────────────►│
     │                 │                  │                 │
     │                 │                  │         Настраивает│
     │                 │                  │         AlarmManager│
     │                 │                  │                 ├──►│
     │                 │                  │                 │
     │                 │ Перенаправление  │                 │
     │◄────────────────┤ на /medicines    │                 │
     │                 │                  │                 │
```

## 5. Sequence диаграмма: Получение уведомления

```
AlarmManager    AlarmReceiver    NotificationManager    Пользователь
     │                │                  │                    │
     │ Время наступило│                  │                    │
     ├───────────────►│                  │                    │
     │                │                  │                    │
     │                │ OnReceive()      │                    │
     │                ├─────────────────►│                    │
     │                │                  │                    │
     │                │                  │ Создаёт уведомление│
     │                │                  ├───────────────────►│
     │                │                  │                    │
     │                │                  │                    │
     │                │                  │     Видит уведомление
     │                │                  │                    │
     │                │                  │ Нажимает на        │
     │                │                  │ уведомление        │
     │                │                  │◄───────────────────┤
     │                │                  │                    │
     │                │                  │ Открывает приложение
     │                │                  ├───────────────────►│
     │                │                  │                    │
```

## 6. Диаграмма компонентов

```
┌────────────────────────────────────────────────┐
│              MedicineReminder.apk              │
│                                                │
│  ┌──────────────────────────────────────────┐ │
│  │         Presentation Layer               │ │
│  │  ┌────────────┐  ┌──────────────────┐   │ │
│  │  │   Blazor   │  │  MainLayout      │   │ │
│  │  │   WebView  │  │  Home.razor      │   │ │
│  │  │            │  │  Medicines.razor │   │ │
│  │  │            │  │  Reminders.razor │   │ │
│  │  └────────────┘  └──────────────────┘   │ │
│  └──────────────────────────────────────────┘ │
│                      │                         │
│  ┌──────────────────▼──────────────────────┐  │
│  │         Business Logic Layer            │  │
│  │  ┌──────────────┐  ┌─────────────────┐ │  │
│  │  │ DataService  │  │ Notification    │ │  │
│  │  │              │  │ Service         │ │  │
│  │  └──────────────┘  └─────────────────┘ │  │
│  └──────────────────────────────────────────┘ │
│                      │                         │
│  ┌──────────────────▼──────────────────────┐  │
│  │            Data Layer                   │  │
│  │  ┌──────────────┐  ┌─────────────────┐ │  │
│  │  │   Models     │  │  JSON Storage   │ │  │
│  │  │   Medicine   │  │  medicines.json │ │  │
│  │  │   Reminder   │  │  reminders.json │ │  │
│  │  └──────────────┘  └─────────────────┘ │  │
│  └──────────────────────────────────────────┘ │
│                                                │
│  ┌──────────────────────────────────────────┐ │
│  │        Android Platform Services         │ │
│  │  ┌──────────────┐  ┌─────────────────┐  │ │
│  │  │AlarmManager  │  │ Notification    │  │ │
│  │  │              │  │ Manager         │  │ │
│  │  └──────────────┘  └─────────────────┘  │ │
│  └──────────────────────────────────────────┘ │
└────────────────────────────────────────────────┘
```

## 7. Диаграмма развертывания

```
┌─────────────────────────────────────┐
│      Android Device                 │
│                                     │
│  ┌───────────────────────────────┐ │
│  │   Android OS (API 21+)        │ │
│  │                               │ │
│  │  ┌─────────────────────────┐ │ │
│  │  │  .NET MAUI Runtime      │ │ │
│  │  │                         │ │ │
│  │  │  ┌───────────────────┐ │ │ │
│  │  │  │ MedicineReminder  │ │ │ │
│  │  │  │      .apk         │ │ │ │
│  │  │  └───────────────────┘ │ │ │
│  │  └─────────────────────────┘ │ │
│  │                               │ │
│  │  ┌─────────────────────────┐ │ │
│  │  │   File System           │ │ │
│  │  │   /data/data/           │ │ │
│  │  │   medicines.json        │ │ │
│  │  │   reminders.json        │ │ │
│  │  └─────────────────────────┘ │ │
│  └───────────────────────────────┘ │
└─────────────────────────────────────┘
```

## 8. Паттерны проектирования

### 8.1 Repository Pattern
`DataService` реализует паттерн Repository для абстракции работы с данными:
- Инкапсулирует логику доступа к данным
- Предоставляет единый интерфейс для CRUD операций
- Скрывает детали хранения (JSON файлы)

### 8.2 Dependency Injection
Используется встроенный DI контейнер .NET:
- Сервисы регистрируются в `MauiProgram.cs`
- Внедряются через конструкторы и `@inject` в Blazor

### 8.3 Observer Pattern
Реализован через события Android:
- `AlarmManager` наблюдает за временем
- `BroadcastReceiver` реагирует на события

### 8.4 Strategy Pattern
`INotificationService` позволяет менять реализацию уведомлений:
- Для Android используется `NotificationService`
- Можно добавить реализацию для iOS

## 9. Принципы SOLID

### Single Responsibility Principle (SRP)
- `DataService` - только работа с данными
- `NotificationService` - только уведомления
- Каждый Blazor компонент отвечает за свою страницу

### Open/Closed Principle (OCP)
- `INotificationService` - открыт для расширения, закрыт для модификации
- Можно добавить новые реализации без изменения существующего кода

### Liskov Substitution Principle (LSP)
- Любая реализация `INotificationService` может заменить другую

### Interface Segregation Principle (ISP)
- `INotificationService` содержит только необходимые методы
- Клиенты не зависят от методов, которые не используют

### Dependency Inversion Principle (DIP)
- Высокоуровневые модули (UI) зависят от абстракций (интерфейсов)
- Низкоуровневые модули (сервисы) реализуют эти абстракции

## 10. Обработка ошибок

### Стратегия обработки ошибок:
1. **Try-Catch блоки** в критических местах (сохранение данных, уведомления)
2. **Валидация данных** на уровне UI
3. **Логирование** ошибок в консоль
4. **Информирование пользователя** через UI сообщения

### Примеры обработки:
- Ошибки сохранения данных → сообщение пользователю
- Ошибки разрешений → запрос повторного предоставления
- Ошибки парсинга JSON → восстановление из резервной копии

## 11. Тестирование

### Тестируемые сценарии:
1. Создание нового лекарства
2. Редактирование существующего лекарства
3. Удаление лекарства
4. Генерация напоминаний
5. Получение уведомлений
6. Отметка о приёме
7. Сохранение и загрузка данных

### Типы тестов:
- **Unit тесты**: Тестирование сервисов и моделей
- **Integration тесты**: Тестирование взаимодействия компонентов
- **UI тесты**: Тестирование пользовательского интерфейса
- **Manual тесты**: Ручное тестирование на устройстве

## 12. Безопасность

### Меры безопасности:
1. **Локальное хранение**: Данные хранятся только на устройстве
2. **Разрешения**: Запрос только необходимых разрешений
3. **Валидация**: Проверка всех пользовательских вводов
4. **Отсутствие сетевой активности**: Нет передачи данных в сеть

### Приватность:
- Данные не покидают устройство
- Отсутствие аналитики и трекинга
- Полный контроль пользователя над своими данными
